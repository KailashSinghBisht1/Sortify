<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Graph Visualizer</title>

    <!-- Common + Graph CSS -->
    <link rel="stylesheet" href="../../css/common.css" />
    <link rel="stylesheet" href="graph.css" />
  </head>

  <body>
    <!-- ================= NAVBAR ================= -->
    <div class="nav-container">
      <div class="navbar">
        <!-- Algorithm -->
        <span class="options">
          <select class="menu algo-menu" id="graphAlgo">
            <option value="">Choose Algorithm</option>
            <option value="bfs">BFS</option>
            <option value="dfs">DFS</option>
            <option value="dijkstra">Dijkstra</option>
          </select>
        </span>

        <!-- Mode -->
        <span class="options">
          <select class="menu" id="graphMode">
            <option value="auto">Auto Graph</option>
            <option value="custom">Custom Graph</option>
          </select>
        </span>

        <!-- Nodes (Auto only) -->
        <span class="options">
          <input
            type="number"
            id="autoNodeCount"
            class="menu"
            placeholder="Nodes"
            min="1"
            max="30"
          />
        </span>

        <!-- Source (Auto only) -->
        <span class="options">
          <input
            type="number"
            id="autoSource"
            class="menu"
            placeholder="Source (optional)"
            min="0"
          />
        </span>

        <!-- Speed -->
        <span class="options">
          <select class="menu speed-menu" id="speed">
            <option value="" disabled selected>Speed</option>
            <option value="0.5">0.5×</option>
            <option value="1">1×</option>
            <option value="2">2×</option>
            <option value="4">4×</option>
          </select>
        </span>

        <!-- Controls -->
        <button id="generateGraph">Generate</button>
        <button class="start" id="startAlgo">Start</button>
        <button id="playPauseBtn">▶ Pause</button>

        <button id="reset">Reset</button>
      </div>
    </div>

    <!-- ================= VISUALIZER ================= -->
    <div class="visualizer-wrapper">
      <!-- GRAPH -->
      <div class="center visualizer-box">
        <svg class="graph-svg" viewBox="0 0 600 350"></svg>
      </div>

      <!-- PATH PANEL -->
      <div class="path-box">
        <h3>Traversal Path</h3>

        <div class="path-info">
          <p><strong>Start:</strong> <span id="pathStart">—</span></p>
          <p><strong>Algorithm:</strong> <span id="pathAlgo">—</span></p>
          <p><strong>Time:</strong> <span id="pathTime">—</span></p>
          <p><strong>Space:</strong> <span id="pathSpace">—</span></p>
        </div>

        <div class="path-list" id="pathList">
          <span class="empty">No traversal yet</span>
        </div>
      </div>
    </div>

    <!-- ================= CUSTOM GRAPH MODAL ================= -->
    <div class="modal-overlay hidden" id="customGraphModal">
      <div class="modal">
        <h3>Custom Graph Input</h3>

        <label>Number of Nodes</label>
        <input type="number" id="nodeCount" min="1" max="30" />

        <label>Edges (u v w)</label>
        <textarea
          id="edgesInput"
          placeholder="0 1 4
0 2 1
2 1 2
1 3 1"
        ></textarea>

        <label>Source Node</label>
        <input type="number" id="startNode" min="0" />

        <div class="modal-actions">
          <button id="cancelGraph" type="button">Cancel</button>
          <button id="applyGraph" type="button">Apply</button>
        </div>
      </div>
    </div>

    <!-- ================= GRAPH LOGIC ================= -->
    <script src="graph.js"></script>

    <!-- ================= UI WIRING ================= -->
    <script>
      const modeSelect = document.getElementById("graphMode");
      const modal = document.getElementById("customGraphModal");
      const autoNodes = document.getElementById("autoNodeCount");
      const autoSource = document.getElementById("autoSource");
      const infoMode = document.getElementById("info-mode");

      /* ================= GENERATE ================= */
      document.getElementById("generateGraph").addEventListener("click", () => {
        if (modeSelect.value === "auto") {
          if (!autoNodes.value || autoNodes.value <= 0) {
            alert("Please enter number of nodes");
            return;
          }
          buildAutoGraph();
        } else {
          modal.classList.remove("hidden");
        }
      });

      /* ================= APPLY CUSTOM ================= */
      document.getElementById("applyGraph").addEventListener("click", () => {
        modal.classList.add("hidden");
        buildGraph();
      });

      /* ================= CANCEL CUSTOM ================= */
      document.getElementById("cancelGraph").addEventListener("click", () => {
        modal.classList.add("hidden");
      });

      /* ================= START ALGORITHM ================= */
      document.getElementById("startAlgo").addEventListener("click", () => {
        const algo = document.getElementById("graphAlgo").value;
        if (!algo) {
          alert("Choose an algorithm first");
          return;
        }

        if (modeSelect.value === "auto" && autoSource.value !== "") {
          const s = Number(autoSource.value);
          if (s < 0 || s >= nodeCount) {
            alert("Invalid source node");
            return;
          }
          startNode = s;
        }

        if (algo === "bfs") runBFS();
        else if (algo === "dfs") runDFS();
        else if (algo === "dijkstra") runDijkstra();
      });

      /* ================= RESET ================= */
      document.getElementById("reset").addEventListener("click", () => {
        hardReset(true); // FULL RESET
        document.getElementById("info-steps").innerText = "Steps: 0";
      });

      /* ================= SPEED ================= */
      document.getElementById("speed").addEventListener("change", (e) => {
        if (!e.target.value) return;
        speed = 600 / Number(e.target.value);
      });

      /* ================= MODE CHANGE ================= */
      modeSelect.addEventListener("change", () => {
        if (infoMode) {
          infoMode.innerText = "Mode: " + modeSelect.value.toUpperCase();
        }

        if (modeSelect.value === "auto") {
          modal.classList.add("hidden");
          autoNodes.disabled = false;
          autoSource.disabled = false;
          autoNodes.value = "";
          autoSource.value = "";
        } else {
          autoNodes.disabled = true;
          autoSource.disabled = true;
          autoSource.value = "";
        }
      });

      /* ================= INIT ================= */
      if (infoMode) infoMode.innerText = "Mode: AUTO";
    </script>
  </body>
</html>
